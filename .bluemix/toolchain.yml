
---
name: "What is for dinner Toolchain"
description: "Microservices sample application"
version: 0.1
required:
 - deploy

# Github repos
git-wfd-eureka:
  service_id: githubpublic
  parameters:
    repo_name: "eureka-clone"
    repo_url: https://github.com/ibm-cloud-architecture/refarch-cloudnative-netflix-eureka
    type: clone
    has_issues: false

git-wfd-config-server:
  service_id: githubpublic
  parameters:
    repo_name: "config-clone"
    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-spring-config"
    type: clone
    has_issues: false


# Pipelines
pipeline-wfd-eureka:
  service_id: pipeline
  parameters:
    name: "wfd-eureka"
    ui-pipeline: true
    configuration:
      content: $file(eureka_pipeline.yml)
      env:
       # Build java stage env variables
       DOCKER_DIR: "docker"
       BUILD_TARGET: "build/libs/eureka-0.0.1-SNAPSHOT.jar"
       REPO: "git-wfd-eureka"
       # Build container stage env variables
       REGION: "{{deploy.parameters.deploy-region}}"
       ORG: "{{deploy.parameters.deploy-org}}"
       SPACE: "{{deploy.parameters.deploy-space}}"
       NAME: "{{pipeline-wfd-eureka.parameters.name}}"
       LABEL_PREFIX: "toolchain"
       # Deploy stage env variables
       PORT: "8761"
       MIN_INSTANCES: "1"
       MAX_INSTANCES: "2"
       DESIRED_INSTANCES: "1"
       CONCURRENT_VERSIONS: "1"
       #AUTO_RECOVERY: "false"
       CONTAINER_SIZE: "micro"
       #IGNORE_MAPPING_ROUTE: "true"
       SERVICE_DISCOVERY_UPS: "eureka-service-discovery"
       BRIDGE_APP: "container_brige_app"
      execute: false
    services: ["git-wfd-eureka"]
  hidden: [form, description]

pipeline-wfd-config:
  service_id: pipeline
  parameters:
    name: "wfd-config"
    ui-pipeline: true
    configuration:
      content: $file(config_pipeline.yml)
      env:
       # Build java stage env variables
       DOCKER_DIR: "docker"
       BUILD_TARGET: "build/libs/config-server-0.0.1-SNAPSHOT.jar"
       REPO: "git-wfd-config-server"
       # Build container stage env variables
       REGION: "{{deploy.parameters.deploy-region}}"
       ORG: "{{deploy.parameters.deploy-org}}"
       SPACE: "{{deploy.parameters.deploy-space}}"
       NAME: "{{pipeline-wfd-config.parameters.name}}"
       LABEL_PREFIX: "toolchain"
       # Deploy stage env variables
       PORT: "8888"
       MIN_INSTANCES: "1"
       MAX_INSTANCES: "2"
       DESIRED_INSTANCES: "1"
       CONCURRENT_VERSIONS: "1"
       #AUTO_RECOVERY: "false"
       CONTAINER_SIZE: "micro"
       #IGNORE_MAPPING_ROUTE: "true"
       #SERVICE_DISCOVERY_UPS: "eureka-service-discovery"
       #BRIDGE_APP: "container_brige_app"
      execute: false
    services: ["git-wfd-config-server"]
  hidden: [form, description]


deploy:
  schema:
    $ref: deployment_schema.json
  service-category: pipeline
  parameters:
    deploy-region: "{{region}}"
    deploy-org: "{{organization}}"
    deploy-space: "{{space}}"
    route-domain: "mybluemix.net"
    context-path: "micro"
